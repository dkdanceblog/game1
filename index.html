
<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>–ú—É–∑—ã–∫–∞–ª—å–Ω–∞—è –∫–∞—Ä—å–µ—Ä–∞ ‚Äî –ª—ë–≥–∫–∏–π —Ñ–æ–Ω (–ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ –Ω–æ—Ç—ã)</title>
<link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet">
<style>
  html, body { margin:0; padding:0; height:100%; background:#050617; overflow:hidden; }
  canvas { display:block; margin:0 auto; }
  #game {
    background: radial-gradient(ellipse at bottom, #0d1d31 0%, #050617 60%, #050617 100%);
    transition: filter .35s ease, transform .25s ease;
  }
  #game.blurred { filter: blur(6px) brightness(.6); transform: scale(1.02); }

  /* –≤–µ—Ä—Ö–Ω–∏–π —Å–ª–æ–π –¥–ª—è –∫–æ–Ω—Ñ–µ—Ç—Ç–∏ */
  #fx {
    position: fixed;
    left: 0; top: 0; width: 100vw; height: 100vh;
    pointer-events: none;
  }

  #hud { position: fixed; top: 10px; left: 16px; color:#fff; font-family:'Russo One', sans-serif; font-size:28px; text-shadow: 0 2px 8px rgba(0,0,0,0.6); }

  #overlay { position:fixed; inset:0; display:none; align-items:center; justify-content:center; text-align:center; color:#fff; font-family:'Russo One', sans-serif; pointer-events:none; }
  #overlay.show { display:flex; animation: fadeUp .45s ease forwards; }
  #card { max-width:min(90vw, 900px); max-height:80vh; overflow:auto; padding:20px 22px; }
  #title { font-size:clamp(28px, 7vw, 56px); margin:0 0 10px; text-shadow:0 6px 24px rgba(0,0,0,.45); }
  #line1 { font-size:clamp(16px, 4.5vw, 24px); margin:8px 0; line-height:1.25; word-break:break-word; }
  #line2 { font-size:clamp(14px, 4vw, 20px); margin:8px 0 0; opacity:0.95; line-height:1.25; word-break:break-word; }
  #hint  { margin-top:14px; font-size:clamp(12px, 3.8vw, 18px); opacity:0.85; }

  @keyframes fadeUp {
    from { transform: translateY(12px); opacity:0; }
    to   { transform: translateY(0); opacity:1; }
  }

  /* MOBILE: portrait fit + disable browser gestures on canvas */
  #game { height: 100vh; width: auto; max-width: 100vw; touch-action: none; }


/* MOBILE SAFE PATCH: portrait fit and disable gestures */
#game { height: 100vh; width: auto; max-width: 100vw; touch-action: none; }

</style>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
</head>
<body>
  <div id="hud">–°–ª—É—à–∞—Ç–µ–ª–∏: <span id="score">0</span></div>
  <canvas id="game" width="600" height=" 900"></canvas>
  <canvas id="fx"></canvas>

  <div id="overlay">
    <div id="card">
      <div id="title">–ö–∞—Ä—å–µ—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞</div>
      <div id="line1"></div>
      <div id="line2"></div>
      <div id="hint">–ö–ª–∏–∫–Ω–∏, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</div>
    </div>
  </div>

<script>
// --- Audio (–æ—á–µ–Ω—å –º—è–≥–∫–∏–µ) ---
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playBeep(freq=440, duration=0.15, type="sine", vol=0.05){
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.type = type;
  osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
  gain.gain.setValueAtTime(vol, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
  osc.connect(gain).connect(audioCtx.destination);
  osc.start();
  osc.stop(audioCtx.currentTime + duration);
}
function sfxJump(){ playBeep(600, 0.18, "sine", 0.01); }   // —Å–≤–µ—Ä—Ö-—Ç–∏—Ö–∏–π –∏ –º—è–≥–∫–∏–π –ø—Ä—ã–∂–æ–∫
function sfxHit(){ playBeep(180, 0.4, "triangle", 0.05); } // –º—è–≥–∫–∏–π ¬´–±—É–º¬ª
function sfxWin(){
  let now = audioCtx.currentTime;
  const notes = [523, 659, 784, 1047];
  notes.forEach((f,i)=>{
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = "sine";
    osc.frequency.setValueAtTime(f, now + i*0.35);
    gain.gain.setValueAtTime(0.06, now + i*0.35);
    gain.gain.exponentialRampToValueAtTime(0.001, now + i*0.35 + 0.3);
    osc.connect(gain).connect(audioCtx.destination);
    osc.start(now + i*0.35);
    osc.stop(now + i*0.35 + 0.3);
  });
}

// --- Canvas ---
const cvs = document.getElementById('game');
const ctx = cvs.getContext('2d');
const fx = document.getElementById('fx');
const fxc = fx.getContext('2d');
function resizeFx(){ fx.width = window.innerWidth; fx.height = window.innerHeight; }
resizeFx(); window.addEventListener('resize', resizeFx);

const hudScore = document.getElementById('score');
const overlay = document.getElementById('overlay');
const titleEl = document.getElementById('title');
const line1 = document.getElementById('line1');
const line2 = document.getElementById('line2');

// --- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ---
const WIN_SCORE = 5000;

// –ò–≥—Ä–æ–∫ (üï∫)
const player = { x:60, y:250, w:40, h:60, vy:0, gravity:0.65, jump:-12 };

// –¢–µ–º—ã –∏ —Ü–≤–µ—Ç–∞
const topicsNomin = ["–ü–æ–ª–∏—Ç–∏–∫–∞","–í–µ—â–µ—Å—Ç–≤–∞","–†–µ–ª–∏–≥–∏—è","–ú–∞—Ç","–¶–µ–Ω–∑—É—Ä–∞","–ü–ª–∞–≥–∏–∞—Ç","–°–µ–∫—Å","–ù–∞—Å–∏–ª–∏–µ","–§–µ–π–∫–∏"];
const topicsAccus = ["–ü–æ–ª–∏—Ç–∏–∫—É","–í–µ—â–µ—Å—Ç–≤–∞","–†–µ–ª–∏–≥–∏—é","–ú–∞—Ç","–¶–µ–Ω–∑—É—Ä—É","–ü–ª–∞–≥–∏–∞—Ç","–°–µ–∫—Å","–ù–∞—Å–∏–ª–∏–µ","–§–µ–π–∫–∏"];
const funny = {
  "–ü–æ–ª–∏—Ç–∏–∫–∞":"–∏ —Ç–≤–æ–π –∫–æ–Ω—Ü–µ—Ä—Ç –≤–Ω–µ–∑–∞–ø–Ω–æ –æ—Ç–º–µ–Ω–∏–ª–∏",
  "–í–µ—â–µ—Å—Ç–≤–∞":"–∏ —Ç—Ä–µ–∫–∏ —Å–Ω–µ—Å–ª–∏ —Å–æ —Å—Ç—Ä–∏–º–∏–Ω–≥–æ–≤",
  "–†–µ–ª–∏–≥–∏—è":"–∏ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –≤–æ–∑–º—É—Ç–∏–ª–∞—Å—å",
  "–ú–∞—Ç":"–∏ –ø—Ä–∏—à–ª–æ—Å—å –≤—Å—ë –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å",
  "–¶–µ–Ω–∑—É—Ä–∞":"–∏ –∞–ª—å–±–æ–º –∏—Å—á–µ–∑ —Å –ø–ª–æ—â–∞–¥–æ–∫",
  "–ü–ª–∞–≥–∏–∞—Ç":"–∏ —Å–ª—É—à–∞—Ç–µ–ª–∏ —Ç–µ–±—è —Ä–∞–∑–æ–±–ª–∞—á–∏–ª–∏",
  "–°–µ–∫—Å":"–∏ –ø—Ä–∏—à–ª–æ—Å—å —Ü–µ–Ω–∑—É—Ä–∏—Ç—å –∫–ª–∏–ø",
  "–ù–∞—Å–∏–ª–∏–µ":"–∏ –Ω–∞—á–∞–ª—Å—è —Å–∫–∞–Ω–¥–∞–ª",
  "–§–µ–π–∫–∏":"–∏ –°–ú–ò –Ω–∞–∑–≤–∞–ª–∏ —Ç–µ–±—è –ª–∂–µ—Ü–æ–º"
};
const colors = {
  "–ü–æ–ª–∏—Ç–∏–∫–∞":"#ff3b30","–í–µ—â–µ—Å—Ç–≤–∞":"#9b59b6","–†–µ–ª–∏–≥–∏—è":"#3498db","–ú–∞—Ç":"#f39c12",
  "–¶–µ–Ω–∑—É—Ä–∞":"#f1c40f","–ü–ª–∞–≥–∏–∞—Ç":"#00d2ff","–°–µ–∫—Å":"#ff6ab9","–ù–∞—Å–∏–ª–∏–µ":"#c0392b","–§–µ–π–∫–∏":"#2ecc71"
};

let obstacles=[], frame=0, score=0, gameOver=false, shake=0;

// --- –õ—ë–≥–∫–∏–π —Ñ–æ–Ω –∏–∑ –Ω–æ—Ç (–ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ, –ª—ë–≥–∫–æ–µ –ø–æ–∫–∞—á–∏–≤–∞–Ω–∏–µ) ---
let notesBg = [];
function spawnNotesLight(n=36){
  notesBg = [];
  for(let i=0;i<n;i++){
    notesBg.push({
      x: Math.random()*cvs.width,
      y: Math.random()*cvs.height,
      baseX: 0,
      size: 22 + Math.random()*14,
      phase: Math.random()*Math.PI*2,
      speed: 0.015 + Math.random()*0.02,
      amp: 1.5 + Math.random()*3,
      alpha: 0.25 + Math.random()*0.3,  // –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å 0.25..0.55
      emoji: Math.random()>0.5 ? "üéµ" : "üé∂"
    });
  }
}
function initNotesBaseX(){ notesBg.forEach(s => { s.baseX = s.x; }); }
spawnNotesLight(36);
initNotesBaseX();

function drawNotesLight(){
  ctx.save();
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  for(const s of notesBg){
    s.phase += s.speed;
    const x = s.baseX + Math.sin(s.phase) * s.amp;
    ctx.font = s.size + "px Arial";
    ctx.globalAlpha = s.alpha;
    ctx.fillText(s.emoji, x, s.y);
  }
  ctx.globalAlpha = 1;
  ctx.restore();
}

// --- –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ (–ø–æ–≤–µ—Ä—Ö –ø—Ä–∏ –ø–æ–±–µ–¥–µ) ---
let confetti=[], confettiRunning=false;
const CONFETTI_COLORS=['#ff3b30','#3498db','#2ecc71','#f1c40f','#e67e22','#9b59b6','#ecf0f1'];
function spawnConfetti(n=160){ confetti=[];
  for(let i=0;i<n;i++){ confetti.push({ x:Math.random()*fx.width, y:-20-Math.random()*fx.height*0.5,
    vx:(Math.random()*2-1)*2, vy:2+Math.random()*3, size:4+Math.random()*5,
    rot:Math.random()*Math.PI*2, vr:(Math.random()*2-1)*0.2,
    color:CONFETTI_COLORS[(Math.random()*CONFETTI_COLORS.length)|0], life:1.0 }); } }
function drawConfetti(){ if(!confettiRunning) return; fxc.clearRect(0,0,fx.width,fx.height);
  confetti.forEach(p=>{ p.x+=p.vx; p.y+=p.vy; p.rot+=p.vr; p.vy*=0.995; p.vx*=0.995;
    if(p.y>fx.height+20){ p.y=-10; p.x=Math.random()*fx.width; } p.life*=0.998;
    fxc.save(); fxc.translate(p.x,p.y); fxc.rotate(p.rot); fxc.fillStyle=p.color;
    fxc.globalAlpha=Math.max(0.3,p.life); fxc.fillRect(-p.size/2,-p.size/2,p.size,p.size*0.6); fxc.restore(); });
  requestAnimationFrame(drawConfetti); }
function startConfetti(){ spawnConfetti(); confettiRunning=true; requestAnimationFrame(drawConfetti); }
function stopConfetti(){ confettiRunning=false; fxc.clearRect(0,0,fx.width,fx.height); }

// --- –ò–≥—Ä–æ–∫ ---
function drawPlayer(){ ctx.font="56px Arial"; ctx.textAlign="left"; ctx.textBaseline="top"; ctx.fillText("üï∫", player.x, player.y); }

// --- –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è ---
function spawnObstacle(){ const idx=Math.floor(Math.random()*topicsNomin.length); const word=topicsNomin[idx];
  const baseY=Math.random()*(cvs.height-240)+100; const seed=Math.random()*1000;
  obstacles.push({ word, x:cvs.width+20, baseY, seed }); }
function updateObstacles(){ if(frame%90===0) spawnObstacle(); obstacles.forEach(o=>o.x-=3);
  if(obstacles.length && obstacles[0].x<-400) obstacles.shift(); }
function drawObstacles(){ ctx.font="36px 'Russo One'"; ctx.textAlign="left"; ctx.textBaseline="alphabetic";
  obstacles.forEach(o=>{ const y=o.baseY+Math.sin((frame+o.seed)/15)*3;
    ctx.shadowColor=colors[o.word]||"#00ffff"; ctx.shadowBlur=18+Math.sin(frame/14)*8;
    ctx.fillStyle=colors[o.word]||"#ffffff"; ctx.fillText(o.word,o.x,y); o._lastY=y; ctx.shadowBlur=0; }); }

// --- –ö–æ–ª–ª–∏–∑–∏—è ---
function checkCollision(){ for(const o of obstacles){ const w=ctx.measureText(o.word).width; const h=34; const y=o._lastY??o.baseY;
  const hitX=player.x<o.x+w && player.x+player.w>o.x; const hitY=player.y<y && (player.y+player.h)>(y-h);
  if(hitX&&hitY){ const i=topicsNomin.indexOf(o.word); const acc=topicsAccus[i]||o.word;
    showGameOver(`–¢–≤–æ—è –∫–∞—Ä—å–µ—Ä–∞ –Ω–∞—Ç–∫–Ω—É–ª–∞—Å—å –Ω–∞ ${acc}`, funny[o.word]); sfxHit(); return true; } } return false; }

// --- –¶–∏–∫–ª ---
function loop(){ if(gameOver) return; ctx.clearRect(0,0,cvs.width,cvs.height); ctx.save();
  // –ª—ë–≥–∫–∏–π —Ñ–æ–Ω
  drawNotesLight();

  // —à–µ–π–∫
  if(shake>0){ const dx=(Math.random()*2-1)*shake; const dy=(Math.random()*2-1)*shake; ctx.translate(dx,dy);
    shake*=0.9; if(shake<0.5) shake=0; }

  // —Ñ–∏–∑–∏–∫–∞
  player.vy+=player.gravity; player.y+=player.vy;

  // –±–∞—Ä—å–µ—Ä—ã
  if(player.y+player.h>=cvs.height){ showGameOver("–¢—ã —Å–∫–∞—Ç–∏–ª—Å—è, –≤—Å–µ –æ—Ç–ø–∏—Å—ã–≤–∞—é—Ç—Å—è",""); sfxHit(); ctx.restore(); return; }
  if(player.y<=0){ showGameOver("–¢—ã –∑–∞–∑–Ω–∞–ª—Å—è –∏ –∑–∞–∏–≥—Ä–∞–ª—Å—è.","–§–∞–Ω–∞—Ç—ã —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω—ã"); sfxHit(); ctx.restore(); return; }

  // —Å—Ü–µ–Ω–∞
  drawPlayer(); updateObstacles(); drawObstacles(); checkCollision();
  ctx.restore();

  // —Å—á—ë—Ç
  frame++; if(frame%2===0){ score++; hudScore.textContent=score; if(score>=WIN_SCORE){ showWin(); return; } }

  requestAnimationFrame(loop);
}

// --- –≠–∫—Ä–∞–Ω—ã ---
function showGameOver(main,sub){ gameOver=true; cvs.classList.add('blurred'); overlay.classList.add('show');
  titleEl.textContent='–ö–∞—Ä—å–µ—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞'; line1.textContent=main||"–¢—ã —Å–∫–∞—Ç–∏–ª—Å—è, –≤—Å–µ –æ—Ç–ø–∏—Å—ã–≤–∞—é—Ç—Å—è"; line2.textContent=sub||"";
  shake=12; document.addEventListener('click',restartOnce,{once:true}); document.addEventListener('keydown',restartOnce,{once:true}); }
function showWin(){ gameOver=true; cvs.classList.add('blurred'); overlay.classList.add('show');
  titleEl.textContent='–£–°–ü–ï–•'; line1.textContent='–¢—ã —Å–æ–±—Ä–∞–ª 10 000 —Å–ª—É—à–∞—Ç–µ–ª–µ–π –∏ —Å—Ç–∞–ª —É—Å–ø–µ—à–Ω—ã–º –º—É–∑—ã–∫–∞–Ω—Ç–æ–º'; line2.textContent='';
  startConfetti(); sfxWin(); document.addEventListener('click',restartOnce,{once:true}); document.addEventListener('keydown',restartOnce,{once:true}); }
function restartOnce(){ restart(); }

// --- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ---
function doJump(e){ if(!gameOver){ player.vy=player.jump; sfxJump(); } }
document.addEventListener('keydown',doJump); document.addEventListener('click',doJump);

// --- –†–µ—Å—Ç–∞—Ä—Ç ---
function restart(){ stopConfetti(); obstacles=[]; frame=0; score=0; player.x=60; player.y=250; player.vy=0; gameOver=false;
  cvs.classList.remove('blurred'); overlay.classList.remove('show'); loop(); }

// –ó–∞–ø—É—Å–∫
loop();

// MOBILE: tap to jump on the canvas (reuse existing click handler)
(function(){
  try {
    var __c = document.getElementById('game');
    if (__c) {
      var __tap = function(e){ e.preventDefault(); document.dispatchEvent(new MouseEvent('click', {bubbles:true})); };
      __c.addEventListener('pointerdown', __tap, {passive:false});
      __c.addEventListener('touchstart', __tap, {passive:false});
    }
  } catch(e){ /* noop */ }
})();
</script>

<!-- MOBILE SAFE PATCH: tap-to-jump without double sound and with audio unlock -->
<script>
(function(){
  var cvs = document.getElementById('game');
  if (!cvs) return;
  var lastTapAt = 0;

  function suppressGhostClick(e){
    var now = performance.now();
    if (now - lastTapAt < 160) {
      e.stopPropagation();
      e.preventDefault();
    }
  }
  // Capture-phase listener to suppress the synthetic click following pointer/touch
  document.addEventListener('click', suppressGhostClick, true);

  function onTap(e){
    lastTapAt = performance.now();
    // try to unlock existing audioCtx if present
    try {
      if (window.audioCtx && typeof window.audioCtx.resume === 'function' && window.audioCtx.state === 'suspended') {
        window.audioCtx.resume();
      }
    } catch(_) {}
    e.preventDefault();
    e.stopPropagation();
    // call existing jump handler if available, else dispatch Space key as fallback
    try {
      if (typeof window.doJump === 'function') {
        window.doJump(e);
      } else {
        document.dispatchEvent(new KeyboardEvent('keydown', {key:' ', code:'Space', bubbles:true}));
      }
    } catch(_) {}
  }

  cvs.addEventListener('pointerdown', onTap, {passive:false});
  cvs.addEventListener('touchstart', onTap, {passive:false});
})();
</script>


<!-- MOBILE TWEAK: softer gravity + stronger jump (no other changes) -->
<script>
(function(){
  function tunePhysics(){
    try {
      if (window.player) {
        // Make falling slower and jump a bit stronger for touch gameplay
        window.player.gravity = 0.45;   // was ~0.65 in desktop-style configs
        window.player.jump    = -14;    // a bit stronger than desktop
      }
    } catch(e){}
  }
  // run once now and again shortly in case game initializes player later
  tunePhysics();
  setTimeout(tunePhysics, 300);
})();
</script>

</body>
</html>
