<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ú—É–∑—ã–∫–∞–ª—å–Ω–∞—è –∫–∞—Ä—å–µ—Ä–∞</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet">

  <style>
    html,body{margin:0;padding:0;height:100%;background:#050617;overflow:hidden}
    #game{
      display:block;margin:0 auto;
      background:radial-gradient(ellipse at bottom,#0d1d31 0%,#050617 60%,#050617 100%);
      height:100vh;width:auto;max-width:100vw;
      transition:filter .35s ease, transform .25s ease;
      touch-action:none;
    }
    #game.blurred{filter:blur(6px) brightness(.6);transform:scale(1.02)}
    #hud{position:fixed;top:10px;left:16px;color:#fff;font-family:'Russo One',sans-serif;
      font-size:22px;text-shadow:0 2px 8px rgba(0,0,0,.6)}
    #overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;
      text-align:center;color:#fff;font-family:'Russo One',sans-serif;pointer-events:none}
    #overlay.show{display:flex;animation:fadeUp .45s ease forwards}
    #card{max-width:min(92vw,480px);max-height:80vh;overflow:auto;padding:18px 20px}
    #title{font-size:clamp(28px,7vw,56px);margin:0 0 10px;text-shadow:0 6px 24px rgba(0,0,0,.45)}
    #line1{font-size:clamp(16px,4.5vw,22px);margin:8px 0;line-height:1.25;word-break:break-word}
    #line2{font-size:clamp(14px,4vw,20px);margin:8px 0 0;opacity:.95;line-height:1.25;word-break:break-word}
    #hint{margin-top:14px;font-size:clamp(12px,3.8vw,18px);opacity:.85}
    @keyframes fadeUp{from{transform:translateY(12px);opacity:0}to{transform:translateY(0);opacity:1}}
  </style>
</head>
<body>
  <div id="hud">–°–ª—É—à–∞—Ç–µ–ª–∏: <span id="score">0</span></div>
  <canvas id="game" width="600" height="900"></canvas>

  <div id="overlay">
    <div id="card">
      <div id="title">–ö–∞—Ä—å–µ—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞</div>
      <div id="line1"></div>
      <div id="line2"></div>
      <div id="hint">–¢–∞–ø–Ω–∏/–∫–ª–∏–∫–Ω–∏, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</div>
    </div>
  </div>

<script>
/* ===================== –Ω–∞—Å—Ç—Ä–æ–π–∫–∏/–¥–µ—Ç–µ–∫—Ç ===================== */
const IS_MOBILE = (window.matchMedia && window.matchMedia('(pointer: coarse)').matches)
  || /Android|iPhone|iPad|iPod|Mobile/i.test(navigator.userAgent);

/* >>> –ü–†–ê–í–ö–ò: —É—Å–∫–æ—Ä–∏–ª–∏ —Å–ª–æ–≤–∞ –∏ —á–∞—â–µ —Å–ø–∞–≤–Ω–∏–º –Ω–∞ –º–æ–±–∏–ª–µ <<< */
const OBSTACLE_SPEED = IS_MOBILE ? 3.5 : 4.5;   // –±—ã–ª–æ 1.7
const SPAWN_EVERY    = IS_MOBILE ? 140 : 90;    // –±—ã–ª–æ 150
/* ----------------------------------------------------------- */

const SCORE_TICK_MS  = IS_MOBILE ? 30  : 33;
const WIN_SCORE = 5000;

/* ===================== –∫–∞–Ω–≤–∞—Å ===================== */
const cvs = document.getElementById('game');
const ctx = cvs.getContext('2d');
const hudScore = document.getElementById('score');
const overlay = document.getElementById('overlay');
const titleEl  = document.getElementById('title');
const line1El  = document.getElementById('line1');
const line2El  = document.getElementById('line2');

/* ===================== –∑–≤—É–∫ (–ª–µ–Ω–∏–≤—ã–π) ===================== */
let audioCtx=null;
function ac(){ if(!audioCtx) audioCtx=new (window.AudioContext||window.webkitAudioContext)(); if(audioCtx.state==='suspended') audioCtx.resume(); return audioCtx; }
function playBeep(freq=440,dur=0.15,type='sine',vol=0.05){
  const A=ac(), o=A.createOscillator(), g=A.createGain();
  o.type=type; o.frequency.setValueAtTime(freq,A.currentTime);
  g.gain.setValueAtTime(vol,A.currentTime);
  g.gain.exponentialRampToValueAtTime(0.001,A.currentTime+dur);
  o.connect(g).connect(A.destination); o.start(); o.stop(A.currentTime+dur);
}
function sfxJump(){ playBeep(620,0.16,'sine',0.012); }
function sfxHit(){  playBeep(170,0.35,'triangle',0.05); }

/* ===================== –∏–≥—Ä–∞: –¥–∞–Ω–Ω—ã–µ ===================== */
const topicsNomin = ["–ü–æ–ª–∏—Ç–∏–∫–∞","–í–µ—â–µ—Å—Ç–≤–∞","–†–µ–ª–∏–≥–∏—è","–ú–∞—Ç","–¶–µ–Ω–∑—É—Ä–∞","–ü–ª–∞–≥–∏–∞—Ç","–°–µ–∫—Å","–ù–∞—Å–∏–ª–∏–µ","–§–µ–π–∫–∏"];
const topicsAccus = ["–ü–æ–ª–∏—Ç–∏–∫—É","–í–µ—â–µ—Å—Ç–≤–∞","–†–µ–ª–∏–≥–∏—é","–ú–∞—Ç","–¶–µ–Ω–∑—É—Ä—É","–ü–ª–∞–≥–∏–∞—Ç","–°–µ–∫—Å","–ù–∞—Å–∏–ª–∏–µ","–§–µ–π–∫–∏"];
const funny = {
  "–ü–æ–ª–∏—Ç–∏–∫–∞":"–∏ —Ç–≤–æ–π –∫–æ–Ω—Ü–µ—Ä—Ç –≤–Ω–µ–∑–∞–ø–Ω–æ –æ—Ç–º–µ–Ω–∏–ª–∏",
  "–í–µ—â–µ—Å—Ç–≤–∞":"–∏ —Ç—Ä–µ–∫–∏ —Å–Ω–µ—Å–ª–∏ —Å–æ —Å—Ç—Ä–∏–º–∏–Ω–≥–æ–≤",
  "–†–µ–ª–∏–≥–∏—è":"–∏ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –≤–æ–∑–º—É—Ç–∏–ª–∞—Å—å",
  "–ú–∞—Ç":"–∏ –ø—Ä–∏—à–ª–æ—Å—å –≤—Å—ë –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å",
  "–¶–µ–Ω–∑—É—Ä–∞":"–∏ –∞–ª—å–±–æ–º –∏—Å—á–µ–∑ —Å –ø–ª–æ—â–∞–¥–æ–∫",
  "–ü–ª–∞–≥–∏–∞—Ç":"–∏ —Å–ª—É—à–∞—Ç–µ–ª–∏ —Ç–µ–±—è —Ä–∞–∑–æ–±–ª–∞—á–∏–ª–∏",
  "–°–µ–∫—Å":"–∏ –ø—Ä–∏—à–ª–æ—Å—å —Ü–µ–Ω–∑—É—Ä–∏—Ç—å –∫–ª–∏–ø",
  "–ù–∞—Å–∏–ª–∏–µ":"–∏ –Ω–∞—á–∞–ª—Å—è —Å–∫–∞–Ω–¥–∞–ª",
  "–§–µ–π–∫–∏":"–∏ –°–ú–ò –Ω–∞–∑–≤–∞–ª–∏ —Ç–µ–±—è –ª–∂–µ—Ü–æ–º"
};
const colors = {
  "–ü–æ–ª–∏—Ç–∏–∫–∞":"#ff3b30","–í–µ—â–µ—Å—Ç–≤–∞":"#9b59b6","–†–µ–ª–∏–≥–∏—è":"#3498db","–ú–∞—Ç":"#f39c12",
  "–¶–µ–Ω–∑—É—Ä–∞":"#f1c40f","–ü–ª–∞–≥–∏–∞—Ç":"#00d2ff","–°–µ–∫—Å":"#ff6ab9","–ù–∞—Å–∏–ª–∏–µ":"#c0392b","–§–µ–π–∫–∏":"#2ecc71"
};

// –±–∞–∑–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–≥—Ä–æ–∫–∞
const BASE_GRAVITY = 0.60;
const BASE_JUMP    = -12.0;
const P_GRAVITY = IS_MOBILE ? BASE_GRAVITY * 0.80 : BASE_GRAVITY;
const P_JUMP    = IS_MOBILE ? BASE_JUMP    * 1.10 : BASE_JUMP;
const MAX_FALL  = IS_MOBILE ? 8 : 12;

const player = { x:60, y:250, w:40, h:60, vy:0, gravity:P_GRAVITY, jump:P_JUMP };

let obstacles=[], score=0, gameOver=false, frame=0;
let lastTs=0, dtFrames=1, dtMs=0, scoreAcc=0;

function drawNotes(){
  ctx.save(); ctx.globalAlpha = .25; ctx.font="26px Arial"; ctx.textAlign='center'; ctx.textBaseline='middle';
  for(let i=0;i<18;i++){
    const x=(i*37)%cvs.width, y=(i*97)%cvs.height, emoji=(i%2? "üéµ":"üé∂");
    ctx.fillText(emoji,x,y);
  }
  ctx.restore();
}
function drawPlayer(){
  ctx.font="56px Arial"; ctx.textAlign='left'; ctx.textBaseline='top';
  ctx.fillText('üï∫', player.x, player.y);
}
function spawnObstacle(){
  const idx = (Math.random()*topicsNomin.length)|0;
  const word = topicsNomin[idx];
  const baseY = Math.random()*(cvs.height-240)+100;
  const seed  = Math.random()*1000;
  obstacles.push({word, x:cvs.width+20, baseY, seed});
}
function updateObstacles(){
  // –ò–ù–ò–¶–ò–ê–õ–¨–ù–´–ô –°–ü–ê–í–ù –°–†–ê–ó–£
  if (updateObstacles.spawnAcc == null) updateObstacles.spawnAcc = SPAWN_EVERY;

  // —Å–ø–∞–≤–Ω –ø–æ –≤—Ä–µ–º–µ–Ω–∏
  updateObstacles.spawnAcc += dtFrames;
  if (updateObstacles.spawnAcc >= SPAWN_EVERY){ spawnObstacle(); updateObstacles.spawnAcc -= SPAWN_EVERY; }

  // –¥–≤–∏–∂–µ–Ω–∏–µ
  obstacles.forEach(o=> o.x -= OBSTACLE_SPEED * dtFrames);
  if(obstacles.length && obstacles[0].x < -400) obstacles.shift();
}
function drawObstacles(){
  /* >>> –ü–†–ê–í–ö–ê: —É–≤–µ–ª–∏—á–∏–ª–∏ —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π <<< */
  ctx.font="42px 'Russo One'";   /* –±—ã–ª–æ 36px */
  /* ---------------------------------------------------- */
  ctx.textAlign='left'; ctx.textBaseline='alphabetic';
  obstacles.forEach(o=>{
    const y = o.baseY + Math.sin((frame+o.seed)/15)*3;
    ctx.save();
    ctx.shadowColor = colors[o.word] || '#00ffff';
    ctx.shadowBlur = 16;
    ctx.fillStyle = colors[o.word] || '#fff';
    ctx.fillText(o.word, o.x, y);
    ctx.restore();
    o._lastY = y;
  });
}
function checkCollision(){
  for(const o of obstacles){
    const w = ctx.measureText(o.word).width;
    const h = 34;
    const y = o._lastY ?? o.baseY;
    const hitX = player.x < o.x + w && player.x + player.w > o.x;
    const hitY = player.y < y && (player.y + player.h) > (y - h);
    if(hitX && hitY){
      const i = topicsNomin.indexOf(o.word);
      const acc = topicsAccus[i] || o.word;
      showGameOver(`–¢–≤–æ—è –∫–∞—Ä—å–µ—Ä–∞ –Ω–∞—Ç–∫–Ω—É–ª–∞—Å—å –Ω–∞ ${acc}`, funny[o.word]);
      sfxHit();
      return true;
    }
  }
  return false;
}

/* ===================== —Ü–∏–∫–ª ===================== */
var __rafId = 0;

function loop(ts){
  if (!lastTs) lastTs = ts;
  dtMs = ts - lastTs;
  dtFrames = Math.max(0.1, Math.min(3, dtMs / 16.6667)); // –Ω–æ—Ä–º–∏—Ä—É–µ–º –∫ 60fps
  lastTs = ts;

  if (gameOver) return;

  ctx.clearRect(0,0,cvs.width,cvs.height);
  drawNotes();

  // –∏–≥—Ä–æ–∫ (–≤—Ä–µ–º—è-–±–∞–∑–æ–≤–∞—è —Ñ–∏–∑–∏–∫–∞)
  player.vy += player.gravity * dtFrames;
  if (player.vy > MAX_FALL) player.vy = MAX_FALL;
  player.y  += player.vy * dtFrames;

  if (player.y + player.h >= cvs.height){
    showGameOver("–¢—ã —Å–∫–∞—Ç–∏–ª—Å—è, –≤—Å–µ –æ—Ç–ø–∏—Å—ã–≤–∞—é—Ç—Å—è","");
    sfxHit(); return;
  }
  if (player.y <= 0){
    showGameOver("–¢—ã –∑–∞–∑–Ω–∞–ª—Å—è –∏ –∑–∞–∏–≥—Ä–∞–ª—Å—è.","–§–∞–Ω–∞—Ç—ã —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω—ã");
    sfxHit(); return;
  }

  drawPlayer();
  updateObstacles();
  drawObstacles();
  checkCollision();

  // —Å—á—ë—Ç
  frame++;
  scoreAcc += dtMs;
  while (scoreAcc >= SCORE_TICK_MS) { score++; scoreAcc -= SCORE_TICK_MS; }
  hudScore.textContent = score;
  if (score >= WIN_SCORE){ showWin(); return; }

  __rafId = requestAnimationFrame(loop);
}

/* ===================== —ç–∫—Ä–∞–Ω—ã ===================== */
function showGameOver(main, sub){
  gameOver = true;
  cvs.classList.add('blurred');
  overlay.classList.add('show');
  titleEl.textContent = "–ö–∞—Ä—å–µ—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞";
  line1El.textContent = main || "";
  line2El.textContent = sub  || "";
  const once = ()=>{ document.removeEventListener('pointerdown',once,true); document.removeEventListener('keydown',once,true); restart(); };
  document.addEventListener('pointerdown', once, true);
  document.addEventListener('keydown',     once, true);
}
function showWin(){
  gameOver = true;
  cvs.classList.add('blurred');
  overlay.classList.add('show');
  titleEl.textContent = "–ü–æ–±–µ–¥–∞!";
  line1El.textContent = "–¢—ã —Å–æ–±—Ä–∞–ª 5000 —Å–ª—É—à–∞—Ç–µ–ª–µ–π!";
  line2El.textContent = "–ó–∞–ª –∞–ø–ª–æ–¥–∏—Ä—É–µ—Ç üëè";
  const once = ()=>{ document.removeEventListener('pointerdown',once,true); document.removeEventListener('keydown',once,true); restart(); };
  document.addEventListener('pointerdown', once, true);
  document.addEventListener('keydown',     once, true);
}

/* ===================== —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ===================== */
let lastJumpAt=0;
function doJump(e){
  const now = performance.now();
  if (now - lastJumpAt < 120) return;
  lastJumpAt = now;
  ac();
  if (!gameOver){
    player.vy = player.jump;
    sfxJump();
  }
}
document.addEventListener('keydown', (e)=>{
  if (e.code === 'Space' || e.code === 'ArrowUp') doJump(e);
});
cvs.addEventListener('pointerdown', (e)=>{ e.preventDefault(); doJump(e); }, {passive:false});
cvs.addEventListener('touchstart',  (e)=>{ e.preventDefault(); doJump(e); }, {passive:false});

/* ===================== —Ä–µ—Å—Ç–∞—Ä—Ç ===================== */
function restart(){
  obstacles = [];
  score = 0;
  frame = 0;
  scoreAcc = 0;
  // –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –ø–µ—Ä–≤—ã–π —Å–ø–∞–≤–Ω –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞
  updateObstacles.spawnAcc = SPAWN_EVERY;

  player.x = 60; player.y = 250; player.vy = 0;
  player.gravity = P_GRAVITY; player.jump = P_JUMP;
  gameOver = false;
  cvs.classList.remove('blurred');
  overlay.classList.remove('show');

  lastTs = 0;
  try { cancelAnimationFrame(__rafId); } catch(e){}
  __rafId = requestAnimationFrame(loop);
}

/* ===================== —Å—Ç–∞—Ä—Ç ===================== */
updateObstacles.spawnAcc = SPAWN_EVERY; // —Å–ø–∞–≤–Ω–∏–º —Å–ª–æ–≤–æ —Å—Ä–∞–∑—É
__rafId = requestAnimationFrame(loop);
</script>
</body>
</html>
